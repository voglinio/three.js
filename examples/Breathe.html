<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width">

	<title>Breathe Project</title>

	<link rel="stylesheet" href="./styles.css">
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>

<body>
<h1>Breathe Project</h1>


<div class="container">
	<img src="./assets/PersonOutline.png" alt="PersonOutline" style="width:100%">
	<button id="button" class="btn">Play</button>
</div>


<audio id="player">
	<source src='./assets/BodySensorTWOSensorsKostas1Left.mp3' type="audio/ogg">
	<p>Browser too old to support HTML5 audio? How depressing!</p>
</audio>

<div class="space"></div>

<body onmousemove="coordinate(event)">

<!-- X coordinate is stored in X-coordinate variable -->
X-coordinate
<input type="text" id="X">
<br>
<br>

<!-- Y coordinate is stored in Y-coordinate variable -->
Y-coordinate
<input type="text" id="Y">


<script>

	var button = document.getElementById("button");

	const AudioContext = window.AudioContext || window.webkitAudioContext;
	let audioCtx;
	const myAudio = document.getElementById("player");

	//const pre = document.querySelector('pre');
	//const myScript = document.querySelector('script');

	//pre.innerHTML = myScript.innerHTML;

	//enableAudio(myAudio);
	//enableAudio(myAudio);


	button.addEventListener("click", function () {
		if (myAudio.paused) {
			myAudio.play();
			button.innerHTML = "Pause";

		} else {
			myAudio.pause();
			button.innerHTML = "Play";
		}
	});


	myAudio.addEventListener('pause', () => {

		let source = audioCtx.createMediaElementSource(myAudio);

	})


	myAudio.addEventListener('play', () => {

		let audioCtx = new AudioContext();

		// Create a MediaElementAudioSourceNode
		// Feed the HTMLMediaElement into it

		let source = audioCtx.createMediaElementSource(myAudio);

		// Create a gain node
		let gainNode = audioCtx.createGain();

		// Create variables to store mouse pointer Y coordinate
		// and HEIGHT of screen
		let CurY;
		let CurX;


		//let HEIGHT = window.innerHeight;
		let HEIGHT = 1;

		// Get new mouse pointer coordinates when mouse is moved
		// then set new gain value


		document.onmousemove = updatePage;

		console.log("play");

		function updatePage(e) {

			CurY = (window.Event) ? e.pageY : event.clientY + (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop);
			CurX = (window.Event) ? e.pageX : event.clientX + (document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft);
			//console.log(CurX);
			var AmpDist = Math.round(Math.abs(100 - CurX) + Math.abs(195 - CurY))

			gainNode.gain.value = HEIGHT / AmpDist;

			myAudio.volume = 1
		}


		// connect the AudioBufferSourceNode to the gainNode
		// and the gainNode to the destination, so we can play the
		// music and adjust the volume using the mouse cursor
		source.connect(gainNode);
		gainNode.connect(audioCtx.destination);

	});


	// coordinate function that calculate the X
	// coordinate and Y coordinates
	function coordinate(event) {

		// clientX gives horizontal coordinate
		var x = event.clientX;

		// clientY gives vertical coordinates
		var y = event.clientY;

		document.getElementById("X").value = x;
		document.getElementById("Y").value = y;

	}

</script>

</body>

</html>
