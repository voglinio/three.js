<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width">

	<title>Breathe Project</title>

	<link rel="stylesheet" href="./styles.css">
	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>

<body>
<h1>Breathe Project</h1>

<div id="circle"></div>

<div class="container">
	<img src="./assets/PersonOutline.png" alt="PersonOutline" style="width:100%">
	<button id="buttonStart" class="btnStart">Start</button>
	<button id="button" class="btn">Enable</button>
	<button id="button1" class="btn1">Enable</button>

</div>

<audio id="player">
	<source src='./assets/BodySensorTWOSensorsKostas2Right.mp3' type="audio/ogg">
	<p>Browser too old to support HTML5 audio? How depressing!</p>
</audio>

<audio id="player1">
	<source src='./assets/BodySensorTWOSensorsKostas1Left.mp3' type="audio/ogg">
	<p>Browser too old to support HTML5 audio? How depressing!</p>
</audio>

<!--Pointer coordinates display-->
<!--<div class="space"></div>-->
<!--
<body onmousemove="coordinate(event)">

X coordinate is stored in X-coordinate variable -->
<!--X-coordinate-->
<!-- <label for="X"></label><input type="text" id="X">-->
<br>
<br>

<!-- Y coordinate is stored in Y-coordinate variable -->
<!--Y-coordinate-->
<!-- <label for="Y"></label><input type="text" id="Y">-->



<script>
	var ball = document.getElementById("circle");

	var buttonStart = document.getElementById("buttonStart");
	var button = document.getElementById("button");
	var button1 = document.getElementById("button1");

	var gainNodeFlag = 0;
	var gainNodeFlag1 = 0;

	var AudioContext = window.AudioContext || window.webkitAudioContext;
	var audioCtx;


	var myAudio = document.getElementById("player");
	var myAudio1 = document.getElementById("player1");

	var pointerX = 250;
	var pointerY = 300;

	//let HEIGHT = window.innerHeight;
	//let WIDTH = window.innerWidth;
	var HEIGHT = 1;

	//Move the pointer
	ball.onmousedown = function (event) {

		let shiftX = event.clientX - ball.getBoundingClientRect().left;
		let shiftY = event.clientY - ball.getBoundingClientRect().top;

		ball.style.position = 'absolute';
		ball.style.zIndex = 1000;
		document.body.append(ball);

		moveAt(event.pageX, event.pageY);


		// moves the ball at (pageX, pageY) coordinates
		// taking initial shifts into account
		function moveAt(pageX, pageY) {
			ball.style.left = pageX - shiftX + 'px';
			ball.style.top = pageY - shiftY + 'px';
		}

		function onMouseMove(event) {
			moveAt(event.pageX, event.pageY);
			pointerX = event.pageX;
			pointerY = event.pageY;


		}

		// move the ball on mousemove
		document.addEventListener('mousemove', onMouseMove);

		// drop the ball, remove unneeded handlers
		ball.onmouseup = function () {
			document.removeEventListener('mousemove', onMouseMove);
			ball.onmouseup = null;
		};

	};


	buttonStart.addEventListener("click", function () {
		if (gainNodeFlag === 0 || gainNodeFlag1 === 0) {
			myAudio.play();
			myAudio1.play();
			gainNodeFlag = 1;
			gainNodeFlag1 = 1;
			buttonStart.innerHTML = "Pause";
			button.innerHTML = "Disable";
			button1.innerHTML = "Disable";
		}

		else  {
			myAudio.pause();
			myAudio1.pause();
			gainNodeFlag = 0;
			gainNodeFlag1 = 0;
			buttonStart.innerHTML = "Start";
			button.innerHTML = "Enable";
			button1.innerHTML = "Enable";
		}
	});



	button.addEventListener("click", function () {
		if (gainNodeFlag === 1) {
			//myAudio.play();
			gainNodeFlag = 0;
			button.innerHTML = "Enable";

		} else {
			//gainNode.gain.value = 0;
			gainNodeFlag = 1;
			button.innerHTML = "Disable";
		}
	});

	button1.addEventListener("click", function () {
		if (gainNodeFlag1 === 1) {
			//myAudio.play();
			gainNodeFlag1 = 0;
			button1.innerHTML = "Enable";

		} else {
			//gainNode.gain.value = 0;
			gainNodeFlag1 = 1;
			button1.innerHTML = "Disable";
		}
	});



	myAudio.addEventListener('play', () => {

		var audioCtx = new AudioContext();

		// Create a MediaElementAudioSourceNode
		// Feed the HTMLMediaElement into it
		let source = audioCtx.createMediaElementSource(myAudio);
		let source1 = audioCtx.createMediaElementSource(myAudio1);

		// Create a gain node
		let gainNode = audioCtx.createGain();
		let gainNode1 = audioCtx.createGain();

		// Create variables to store mouse pointer Y coordinate
		// and HEIGHT of screen
		let CurY;
		let CurX;

		// Get new mouse pointer coordinates when mouse is moved
		// then set new gain value

		document.onmousemove = updatePage;

		function updatePage(e) {

			CurY = (window.Event) ? e.pageY : event.clientY + (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop);
			CurX = (window.Event) ? e.pageX : event.clientX + (document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft);
			//var AmpDist = Math.round(Math.abs(151 - CurX) + Math.abs(260) - CurY)

			var AmpDist = Math.round(Math.abs(151 - pointerX) + Math.abs(260 - pointerY))
			var AmpDist1 = Math.round(Math.abs(242 - pointerX) + Math.abs(260- pointerY))



			if(gainNodeFlag === 1) {

				gainNode.gain.value = HEIGHT/AmpDist;
			}
			else {
				gainNode.gain.value =0
				gainNodeFlag = 0;
			}


			if(gainNodeFlag1 === 1) {
				gainNode1.gain.value = HEIGHT/AmpDist1;
			}
			else {
				gainNode1.gain.value =0
				gainNodeFlag1 = 0;
			}

			//audioCtx.volume = 1;
		}


		// connect the AudioBufferSourceNode to the gainNode
		// and the gainNode to the destination, so we can play the
		// music and adjust the volume using the mouse cursor
		source.connect(gainNode);
		source1.connect(gainNode1);

		gainNode.connect(audioCtx.destination);
		gainNode1.connect(audioCtx.destination);

	});


	// coordinate function that calculate the X
	// coordinate and Y coordinates
	function coordinate(event) {

		// clientX gives horizontal coordinate
		var x = event.clientX;

		// clientY gives vertical coordinates
		var y = event.clientY;

		document.getElementById("X").value = x;
		document.getElementById("Y").value = y;

	}

</script>




